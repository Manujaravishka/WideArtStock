<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Management System</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background-color: #f8f9fa;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .stat-card {
            border-radius: 10px;
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 2.5rem;
            opacity: 0.3;
        }

        .table th {
            background-color: #f8f9fa;
        }

        .status-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-in-stock {
            background-color: #d4edda;
            color: #155724;
        }

        .status-low-stock {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-out-of-stock {
            background-color: #f8d7da;
            color: #721c24;
        }

        .nav-link.active {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }
    </style>
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">
            <i class="bi bi-box-seam me-2"></i>Stock Management System
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="#" data-section="dashboard">
                        <i class="bi bi-speedometer2"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="stock">
                        <i class="bi bi-box"></i> Stock
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="add">
                        <i class="bi bi-plus-circle"></i> Add Stock
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="history">
                        <i class="bi bi-clock-history"></i> History
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="reports">
                        <i class="bi bi-file-earmark-text"></i> Reports
                    </a>
                </li>
            </ul>
            <div class="navbar-nav">
                <div class="nav-item">
                        <span class="nav-link">
                            <i class="bi bi-person-circle"></i> Admin
                        </span>
                </div>
            </div>
        </div>
    </div>
</nav>

<!-- Main Content -->
<div class="container-fluid mt-4">
    <!-- App Sections -->
    <div id="appSections">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <h2 class="mb-4"><i class="bi bi-speedometer2 me-2"></i>Dashboard</h2>

            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-md-3 mb-3">
                    <div class="card stat-card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="text-muted">Total Items</h6>
                                    <h3 id="totalItems">0</h3>
                                </div>
                                <div class="stat-icon">
                                    <i class="bi bi-boxes"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="text-muted">Low Stock</h6>
                                    <h3 id="lowStock">0</h3>
                                </div>
                                <div class="stat-icon">
                                    <i class="bi bi-exclamation-triangle"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="text-muted">Total Value</h6>
                                    <h3 id="totalValue">$0</h3>
                                </div>
                                <div class="stat-icon">
                                    <i class="bi bi-currency-dollar"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="text-muted">Today's Updates</h6>
                                    <h3 id="todayUpdates">0</h3>
                                </div>
                                <div class="stat-icon">
                                    <i class="bi bi-arrow-up-circle"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Stock Overview</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="stockChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Low Stock Alert</h5>
                        </div>
                        <div class="card-body">
                            <div id="lowStockList" style="max-height: 300px; overflow-y: auto;">
                                <!-- Low stock items will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Recent Activity</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th>Time</th>
                                <th>Action</th>
                                <th>Item</th>
                                <th>User</th>
                            </tr>
                            </thead>
                            <tbody id="recentActivity">
                            <!-- Recent activity will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stock List Section -->
        <section id="stock" class="section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-box me-2"></i>Stock Items</h2>
                <div>
                    <input type="text" class="form-control" id="searchStock" placeholder="Search items...">
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Quantity</th>
                                <th>Unit Price</th>
                                <th>Total Value</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                            </thead>
                            <tbody id="stockTable">
                            <!-- Stock items will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <div>Showing <span id="itemCount">0</span> items</div>
                        <nav>
                            <ul class="pagination pagination-sm mb-0" id="pagination">
                                <!-- Pagination will be generated here -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </section>

        <!-- Add Stock Section -->
        <section id="add" class="section">
            <h2 class="mb-4"><i class="bi bi-plus-circle me-2"></i>Add Stock</h2>

            <div class="row">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Add New Item</h5>
                        </div>
                        <div class="card-body">
                            <form id="addStockForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="itemName" class="form-label">Item Name *</label>
                                        <input type="text" class="form-control" id="itemName" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="itemCategory" class="form-label">Category *</label>
                                        <select class="form-select" id="itemCategory" required>
                                            <option value="">Select Category</option>
                                            <option value="Electronics">Electronics</option>
                                            <option value="Clothing">Clothing</option>
                                            <option value="Food">Food & Beverages</option>
                                            <option value="Office Supplies">Office Supplies</option>
                                            <option value="Hardware">Hardware</option>
                                            <option value="Pharmaceuticals">Pharmaceuticals</option>
                                            <option value="Books">Books</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label for="itemQuantity" class="form-label">Quantity *</label>
                                        <input type="number" class="form-control" id="itemQuantity" min="0" required>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="itemPrice" class="form-label">Unit Price ($) *</label>
                                        <input type="number" class="form-control" id="itemPrice" min="0.01" step="0.01" required>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="itemThreshold" class="form-label">Low Stock Threshold</label>
                                        <input type="number" class="form-control" id="itemThreshold" min="1" value="10">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="itemDescription" class="form-label">Description</label>
                                    <textarea class="form-control" id="itemDescription" rows="3"></textarea>
                                </div>

                                <div class="mb-3">
                                    <label for="itemSupplier" class="form-label">Supplier</label>
                                    <input type="text" class="form-control" id="itemSupplier">
                                </div>

                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-plus-circle me-2"></i>Add Stock Item
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Update Stock</h5>
                        </div>
                        <div class="card-body">
                            <form id="updateStockForm">
                                <div class="mb-3">
                                    <label for="updateItem" class="form-label">Select Item *</label>
                                    <select class="form-select" id="updateItem" required>
                                        <option value="">Select Item</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label for="updateAction" class="form-label">Action *</label>
                                    <select class="form-select" id="updateAction" required>
                                        <option value="add">Add Stock</option>
                                        <option value="remove">Remove Stock</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label for="updateQuantity" class="form-label">Quantity *</label>
                                    <input type="number" class="form-control" id="updateQuantity" min="1" required>
                                </div>

                                <div class="mb-3">
                                    <label for="updateReason" class="form-label">Reason</label>
                                    <textarea class="form-control" id="updateReason" rows="2"></textarea>
                                </div>

                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="bi bi-arrow-repeat me-2"></i>Update Stock
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- History Section -->
        <section id="history" class="section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-clock-history me-2"></i>Stock History</h2>
                <div>
                    <select class="form-select" id="historyFilter">
                        <option value="all">All Actions</option>
                        <option value="add">Add Items</option>
                        <option value="update">Update Stock</option>
                        <option value="delete">Delete Items</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th>Date & Time</th>
                                <th>Action</th>
                                <th>Item</th>
                                <th>Quantity Change</th>
                                <th>Previous Qty</th>
                                <th>New Qty</th>
                                <th>User</th>
                            </tr>
                            </thead>
                            <tbody id="historyTable">
                            <!-- History items will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <div>Showing <span id="historyCount">0</span> records</div>
                        <nav>
                            <ul class="pagination pagination-sm mb-0" id="historyPagination">
                                <!-- Pagination will be generated here -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </section>

        <!-- Reports Section -->
        <section id="reports" class="section">
            <h2 class="mb-4"><i class="bi bi-file-earmark-text me-2"></i>Reports</h2>

            <div class="row">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Today's Report</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-6 col-md-3 mb-3">
                                    <div class="text-center p-3 border rounded">
                                        <h6 class="text-muted">Added</h6>
                                        <h4 id="todayAdded">0</h4>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3 mb-3">
                                    <div class="text-center p-3 border rounded">
                                        <h6 class="text-muted">Updated</h6>
                                        <h4 id="todayUpdated">0</h4>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3 mb-3">
                                    <div class="text-center p-3 border rounded">
                                        <h6 class="text-muted">Deleted</h6>
                                        <h4 id="todayDeleted">0</h4>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3 mb-3">
                                    <div class="text-center p-3 border rounded">
                                        <h6 class="text-muted">Total</h6>
                                        <h4 id="todayTotal">0</h4>
                                    </div>
                                </div>
                            </div>

                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Item</th>
                                        <th>Action</th>
                                        <th>Qty Change</th>
                                        <th>User</th>
                                    </tr>
                                    </thead>
                                    <tbody id="todayReportTable">
                                    <!-- Today's report items will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Generate Report</h5>
                        </div>
                        <div class="card-body">
                            <form id="reportForm">
                                <div class="mb-3">
                                    <label for="reportType" class="form-label">Report Type</label>
                                    <select class="form-select" id="reportType">
                                        <option value="daily">Daily Report</option>
                                        <option value="weekly">Weekly Report</option>
                                        <option value="monthly">Monthly Report</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                </div>

                                <div class="mb-3" id="customRange" style="display: none;">
                                    <div class="row">
                                        <div class="col-6">
                                            <label for="startDate" class="form-label">Start</label>
                                            <input type="date" class="form-control" id="startDate">
                                        </div>
                                        <div class="col-6">
                                            <label for="endDate" class="form-label">End</label>
                                            <input type="date" class="form-control" id="endDate">
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="reportFormat" class="form-label">Format</label>
                                    <select class="form-select" id="reportFormat">
                                        <option value="json">JSON</option>
                                        <option value="csv">CSV</option>
                                        <option value="pdf">PDF</option>
                                    </select>
                                </div>

                                <button type="button" class="btn btn-primary w-100" id="generateReportBtn">
                                    <i class="bi bi-download me-2"></i>Generate Report
                                </button>
                            </form>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="mb-0">Category Distribution</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>

<!-- Modals -->
<!-- Edit Stock Modal -->
<div class="modal fade" id="editStockModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Stock Item</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editStockForm">
                    <input type="hidden" id="editItemId">
                    <div class="mb-3">
                        <label for="editItemName" class="form-label">Item Name</label>
                        <input type="text" class="form-control" id="editItemName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editItemCategory" class="form-label">Category</label>
                        <select class="form-select" id="editItemCategory" required>
                            <option value="Electronics">Electronics</option>
                            <option value="Clothing">Clothing</option>
                            <option value="Food">Food & Beverages</option>
                            <option value="Office Supplies">Office Supplies</option>
                            <option value="Hardware">Hardware</option>
                            <option value="Pharmaceuticals">Pharmaceuticals</option>
                            <option value="Books">Books</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editItemQuantity" class="form-label">Quantity</label>
                            <input type="number" class="form-control" id="editItemQuantity" min="0" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editItemPrice" class="form-label">Unit Price ($)</label>
                            <input type="number" class="form-control" id="editItemPrice" min="0.01" step="0.01" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="editItemDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="editItemDescription" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveEditBtn">Save Changes</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this item?</p>
                <p><strong id="deleteItemName"></strong></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Stock Management System JavaScript

    // Sample initial data
    let stockItems = JSON.parse(localStorage.getItem('stockItems')) || [
        {
            id: 1,
            name: "Laptop",
            category: "Electronics",
            quantity: 15,
            price: 899.99,
            threshold: 5,
            description: "Dell Inspiron 15",
            supplier: "Tech Supplies Inc",
            totalValue: 13499.85,
            status: "In Stock"
        },
        {
            id: 2,
            name: "Office Chair",
            category: "Office Supplies",
            quantity: 8,
            price: 149.99,
            threshold: 10,
            description: "Ergonomic office chair",
            supplier: "Office Depot",
            totalValue: 1199.92,
            status: "Low Stock"
        },
        {
            id: 3,
            name: "Notebooks",
            category: "Office Supplies",
            quantity: 150,
            price: 2.99,
            threshold: 20,
            description: "A4 size notebooks",
            supplier: "Paper Co",
            totalValue: 448.5,
            status: "In Stock"
        }
    ];

    let stockHistory = JSON.parse(localStorage.getItem('stockHistory')) || [
        {
            id: 1,
            date: "2024-01-15 09:30:00",
            action: "Add",
            item: "Laptop",
            quantityChange: "+10",
            previousQty: 5,
            newQty: 15,
            user: "Admin"
        },
        {
            id: 2,
            date: "2024-01-15 10:15:00",
            action: "Update",
            item: "Office Chair",
            quantityChange: "-2",
            previousQty: 10,
            newQty: 8,
            user: "Admin"
        }
    ];

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
        // Update item status based on quantity and threshold
        updateItemStatus();

        // Save initial data to localStorage
        saveToLocalStorage();

        // Initialize dashboard
        updateDashboard();

        // Load stock table
        loadStockTable();

        // Load history table
        loadHistoryTable();

        // Update dropdown with current items
        updateItemDropdown();

        // Setup event listeners
        setupEventListeners();

        // Initialize charts
        initializeCharts();
    });

    // Save data to localStorage
    function saveToLocalStorage() {
        localStorage.setItem('stockItems', JSON.stringify(stockItems));
        localStorage.setItem('stockHistory', JSON.stringify(stockHistory));
    }

    // Update item status based on quantity
    function updateItemStatus() {
        stockItems.forEach(item => {
            if (item.quantity <= 0) {
                item.status = "Out of Stock";
            } else if (item.quantity <= item.threshold) {
                item.status = "Low Stock";
            } else {
                item.status = "In Stock";
            }
            item.totalValue = item.quantity * item.price;
        });
    }

    // Update dashboard stats
    function updateDashboard() {
        const totalItems = stockItems.length;
        const lowStock = stockItems.filter(item => item.status === "Low Stock" || item.status === "Out of Stock").length;
        const totalValue = stockItems.reduce((sum, item) => sum + item.totalValue, 0);

        // Today's date for filtering
        const today = new Date().toISOString().split('T')[0];
        const todayUpdates = stockHistory.filter(record =>
            record.date.startsWith(today)
        ).length;

        document.getElementById('totalItems').textContent = totalItems;
        document.getElementById('lowStock').textContent = lowStock;
        document.getElementById('totalValue').textContent = '$' + totalValue.toFixed(2);
        document.getElementById('todayUpdates').textContent = todayUpdates;

        // Update low stock list
        updateLowStockList();

        // Update recent activity
        updateRecentActivity();

        // Update today's report
        updateTodayReport();
    }

    // Update low stock list
    function updateLowStockList() {
        const lowStockList = document.getElementById('lowStockList');
        const lowStockItems = stockItems.filter(item =>
            item.status === "Low Stock" || item.status === "Out of Stock"
        );

        if (lowStockItems.length === 0) {
            lowStockList.innerHTML = '<div class="text-center text-muted p-3">No low stock items</div>';
            return;
        }

        lowStockList.innerHTML = '';
        lowStockItems.forEach(item => {
            const statusClass = item.status === "Out of Stock" ?
                'status-out-of-stock' : 'status-low-stock';

            const itemDiv = document.createElement('div');
            itemDiv.className = 'd-flex justify-content-between align-items-center mb-2 p-2 border-bottom';
            itemDiv.innerHTML = `
                    <div>
                        <strong>${item.name}</strong><br>
                        <small class="text-muted">Qty: ${item.quantity} (Threshold: ${item.threshold})</small>
                    </div>
                    <span class="status-badge ${statusClass}">${item.status}</span>
                `;
            lowStockList.appendChild(itemDiv);
        });
    }

    // Update recent activity
    function updateRecentActivity() {
        const recentActivity = document.getElementById('recentActivity');
        const recentItems = [...stockHistory].reverse().slice(0, 5);

        recentActivity.innerHTML = '';
        recentItems.forEach(record => {
            const row = document.createElement('tr');

            // Determine action icon and color
            let actionIcon = 'bi-plus-circle';
            let actionColor = 'success';
            if (record.action === 'Update') {
                actionIcon = 'bi-arrow-repeat';
                actionColor = 'warning';
            } else if (record.action === 'Delete') {
                actionIcon = 'bi-trash';
                actionColor = 'danger';
            }

            row.innerHTML = `
                    <td>${record.date}</td>
                    <td>
                        <span class="badge bg-${actionColor}">
                            <i class="bi ${actionIcon} me-1"></i>${record.action}
                        </span>
                    </td>
                    <td>${record.item}</td>
                    <td>${record.user}</td>
                `;
            recentActivity.appendChild(row);
        });
    }

    // Update today's report
    function updateTodayReport() {
        const today = new Date().toISOString().split('T')[0];
        const todayRecords = stockHistory.filter(record =>
            record.date.startsWith(today)
        );

        const added = todayRecords.filter(r => r.action === 'Add').length;
        const updated = todayRecords.filter(r => r.action === 'Update').length;
        const deleted = todayRecords.filter(r => r.action === 'Delete').length;
        const total = added + updated + deleted;

        document.getElementById('todayAdded').textContent = added;
        document.getElementById('todayUpdated').textContent = updated;
        document.getElementById('todayDeleted').textContent = deleted;
        document.getElementById('todayTotal').textContent = total;

        // Update today's report table
        const todayReportTable = document.getElementById('todayReportTable');
        todayReportTable.innerHTML = '';

        todayRecords.reverse().forEach(record => {
            const row = document.createElement('tr');

            // Time only (remove date)
            const time = record.date.split(' ')[1];

            row.innerHTML = `
                    <td>${time}</td>
                    <td>${record.item}</td>
                    <td>${record.action}</td>
                    <td>${record.quantityChange}</td>
                    <td>${record.user}</td>
                `;
            todayReportTable.appendChild(row);
        });
    }

    // Load stock table
    function loadStockTable() {
        const stockTable = document.getElementById('stockTable');
        const itemCount = document.getElementById('itemCount');

        stockTable.innerHTML = '';

        stockItems.forEach((item, index) => {
            const statusClass = item.status === "In Stock" ? 'status-in-stock' :
                item.status === "Low Stock" ? 'status-low-stock' :
                    'status-out-of-stock';

            const row = document.createElement('tr');
            row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>
                        <strong>${item.name}</strong>
                        ${item.description ? `<br><small class="text-muted">${item.description}</small>` : ''}
                    </td>
                    <td>${item.category}</td>
                    <td>${item.quantity}</td>
                    <td>$${item.price.toFixed(2)}</td>
                    <td>$${item.totalValue.toFixed(2)}</td>
                    <td><span class="status-badge ${statusClass}">${item.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary edit-btn" data-id="${item.id}">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger delete-btn" data-id="${item.id}" data-name="${item.name}">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
            stockTable.appendChild(row);
        });

        itemCount.textContent = stockItems.length;

        // Add event listeners to edit and delete buttons
        document.querySelectorAll('.edit-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const itemId = parseInt(this.getAttribute('data-id'));
                editStockItem(itemId);
            });
        });

        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const itemId = parseInt(this.getAttribute('data-id'));
                const itemName = this.getAttribute('data-name');
                showDeleteModal(itemId, itemName);
            });
        });
    }

    // Load history table
    function loadHistoryTable() {
        const historyTable = document.getElementById('historyTable');
        const historyCount = document.getElementById('historyCount');

        historyTable.innerHTML = '';

        stockHistory.forEach(record => {
            const row = document.createElement('tr');

            // Determine action color
            let actionColor = 'success';
            if (record.action === 'Update') {
                actionColor = 'warning';
            } else if (record.action === 'Delete') {
                actionColor = 'danger';
            }

            row.innerHTML = `
                    <td>${record.date}</td>
                    <td>
                        <span class="badge bg-${actionColor}">${record.action}</span>
                    </td>
                    <td>${record.item}</td>
                    <td>${record.quantityChange}</td>
                    <td>${record.previousQty}</td>
                    <td>${record.newQty}</td>
                    <td>${record.user}</td>
                `;
            historyTable.appendChild(row);
        });

        historyCount.textContent = stockHistory.length;
    }

    // Update item dropdown for stock updates
    function updateItemDropdown() {
        const updateItemSelect = document.getElementById('updateItem');
        updateItemSelect.innerHTML = '<option value="">Select Item</option>';

        stockItems.forEach(item => {
            const option = document.createElement('option');
            option.value = item.id;
            option.textContent = `${item.name} (Current: ${item.quantity})`;
            updateItemSelect.appendChild(option);
        });
    }

    // Setup event listeners
    function setupEventListeners() {
        // Navigation
        document.querySelectorAll('.nav-link[data-section]').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();


                
                // Remove active class from all links
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));

                // Add active class to clicked link
                this.classList.add('active');

                // Hide all sections
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });

                // Show selected section
                const sectionId = this.getAttribute('data-section');
                document.getElementById(sectionId).classList.add('active');
            });
        });

        // Add stock form
        document.getElementById('addStockForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const newItem = {
                id: stockItems.length > 0 ? Math.max(...stockItems.map(i => i.id)) + 1 : 1,
                name: document.getElementById('itemName').value,
                category: document.getElementById('itemCategory').value,
                quantity: parseInt(document.getElementById('itemQuantity').value),
                price: parseFloat(document.getElementById('itemPrice').value),
                threshold: parseInt(document.getElementById('itemThreshold').value) || 10,
                description: document.getElementById('itemDescription').value,
                supplier: document.getElementById('itemSupplier').value,
                totalValue: 0,
                status: "In Stock"
            };

            // Calculate total value
            newItem.totalValue = newItem.quantity * newItem.price;
            updateItemStatusForItem(newItem);

            // Add to stock items
            stockItems.push(newItem);

            // Add to history
            const historyRecord = {
                id: stockHistory.length > 0 ? Math.max(...stockHistory.map(h => h.id)) + 1 : 1,
                date: new Date().toISOString().replace('T', ' ').substr(0, 19),
                action: "Add",
                item: newItem.name,
                quantityChange: `+${newItem.quantity}`,
                previousQty: 0,
                newQty: newItem.quantity,
                user: "Admin"
            };
            stockHistory.push(historyRecord);

            // Save to localStorage
            saveToLocalStorage();

            // Update UI
            updateDashboard();
            loadStockTable();
            updateItemDropdown();

            // Reset form
            this.reset();
            document.getElementById('itemThreshold').value = 10;

            // Show success message
            showAlert('Stock item added successfully!', 'success');
        });

        // Update stock form
        document.getElementById('updateStockForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const itemId = parseInt(document.getElementById('updateItem').value);
            const action = document.getElementById('updateAction').value;
            const quantity = parseInt(document.getElementById('updateQuantity').value);
            const reason = document.getElementById('updateReason').value;

            if (!itemId) {
                showAlert('Please select an item!', 'danger');
                return;
            }

            const itemIndex = stockItems.findIndex(item => item.id === itemId);
            if (itemIndex === -1) {
                showAlert('Item not found!', 'danger');
                return;
            }

            const item = stockItems[itemIndex];
            const previousQty = item.quantity;
            let newQty = previousQty;
            let quantityChange = '';

            if (action === 'add') {
                newQty = previousQty + quantity;
                quantityChange = `+${quantity}`;
            } else if (action === 'remove') {
                if (quantity > previousQty) {
                    showAlert('Cannot remove more than available quantity!', 'danger');
                    return;
                }
                newQty = previousQty - quantity;
                quantityChange = `-${quantity}`;
            }

            // Update item
            stockItems[itemIndex].quantity = newQty;
            updateItemStatusForItem(stockItems[itemIndex]);
            stockItems[itemIndex].totalValue = newQty * stockItems[itemIndex].price;

            // Add to history
            const historyRecord = {
                id: stockHistory.length > 0 ? Math.max(...stockHistory.map(h => h.id)) + 1 : 1,
                date: new Date().toISOString().replace('T', ' ').substr(0, 19),
                action: "Update",
                item: item.name,
                quantityChange: quantityChange,
                previousQty: previousQty,
                newQty: newQty,
                user: "Admin",
                reason: reason
            };
            stockHistory.push(historyRecord);

            // Save to localStorage
            saveToLocalStorage();

            // Update UI
            updateDashboard();
            loadStockTable();
            loadHistoryTable();
            updateItemDropdown();

            // Reset form
            this.reset();

            // Show success message
            showAlert('Stock updated successfully!', 'success');
        });

        // History filter
        document.getElementById('historyFilter').addEventListener('change', function() {
            // For now, just reload all history
            // In a real app, you would filter the history
            loadHistoryTable();
        });

        // Search stock
        document.getElementById('searchStock').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('#stockTable tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        // Report type change
        document.getElementById('reportType').addEventListener('change', function() {
            const customRange = document.getElementById('customRange');
            customRange.style.display = this.value === 'custom' ? 'block' : 'none';
        });

        // Generate report button
        document.getElementById('generateReportBtn').addEventListener('click', function() {
            const reportType = document.getElementById('reportType').value;
            const reportFormat = document.getElementById('reportFormat').value;

            let reportData = {};
            let fileName = 'stock-report';

            if (reportType === 'daily') {
                const today = new Date().toISOString().split('T')[0];
                reportData = {
                    type: 'Daily Report',
                    date: today,
                    items: stockItems,
                    history: stockHistory.filter(h => h.date.startsWith(today))
                };
                fileName = `daily-report-${today}`;
            } else if (reportType === 'weekly') {
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                reportData = {
                    type: 'Weekly Report',
                    startDate: oneWeekAgo.toISOString().split('T')[0],
                    endDate: new Date().toISOString().split('T')[0],
                    items: stockItems,
                    history: stockHistory
                };
                fileName = `weekly-report-${new Date().toISOString().split('T')[0]}`;
            } else if (reportType === 'monthly') {
                reportData = {
                    type: 'Monthly Report',
                    month: new Date().getMonth() + 1,
                    year: new Date().getFullYear(),
                    items: stockItems,
                    history: stockHistory
                };
                fileName = `monthly-report-${new Date().getFullYear()}-${new Date().getMonth() + 1}`;
            } else if (reportType === 'custom') {
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;

                if (!startDate || !endDate) {
                    showAlert('Please select both start and end dates!', 'danger');
                    return;
                }

                reportData = {
                    type: 'Custom Report',
                    startDate: startDate,
                    endDate: endDate,
                    items: stockItems,
                    history: stockHistory.filter(h => {
                        const recordDate = h.date.split(' ')[0];
                        return recordDate >= startDate && recordDate <= endDate;
                    })
                };
                fileName = `custom-report-${startDate}-to-${endDate}`;
            }

            // Generate report based on format
            if (reportFormat === 'json') {
                downloadJSON(reportData, fileName);
            } else if (reportFormat === 'csv') {
                downloadCSV(reportData, fileName);
            } else {
                showAlert('PDF generation would require a server component. Try JSON or CSV format.', 'info');
            }
        });

        // Save edit button
        document.getElementById('saveEditBtn').addEventListener('click', function() {
            const itemId = parseInt(document.getElementById('editItemId').value);
            const itemIndex = stockItems.findIndex(item => item.id === itemId);

            if (itemIndex === -1) {
                showAlert('Item not found!', 'danger');
                return;
            }

            // Update item
            stockItems[itemIndex].name = document.getElementById('editItemName').value;
            stockItems[itemIndex].category = document.getElementById('editItemCategory').value;
            stockItems[itemIndex].quantity = parseInt(document.getElementById('editItemQuantity').value);
            stockItems[itemIndex].price = parseFloat(document.getElementById('editItemPrice').value);
            stockItems[itemIndex].description = document.getElementById('editItemDescription').value;

            // Recalculate
            updateItemStatusForItem(stockItems[itemIndex]);
            stockItems[itemIndex].totalValue = stockItems[itemIndex].quantity * stockItems[itemIndex].price;

            // Add to history
            const historyRecord = {
                id: stockHistory.length > 0 ? Math.max(...stockHistory.map(h => h.id)) + 1 : 1,
                date: new Date().toISOString().replace('T', ' ').substr(0, 19),
                action: "Update",
                item: stockItems[itemIndex].name,
                quantityChange: "0",
                previousQty: stockItems[itemIndex].quantity,
                newQty: stockItems[itemIndex].quantity,
                user: "Admin",
                reason: "Item details updated"
            };
            stockHistory.push(historyRecord);

            // Save to localStorage
            saveToLocalStorage();

            // Update UI
            updateDashboard();
            loadStockTable();
            updateItemDropdown();
            loadHistoryTable();

            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('editStockModal'));
            modal.hide();

            // Show success message
            showAlert('Item updated successfully!', 'success');
        });

        // Confirm delete button
        document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
            const itemId = parseInt(this.getAttribute('data-item-id'));
            const itemIndex = stockItems.findIndex(item => item.id === itemId);

            if (itemIndex === -1) {
                showAlert('Item not found!', 'danger');
                return;
            }

            const deletedItem = stockItems[itemIndex];

            // Add to history
            const historyRecord = {
                id: stockHistory.length > 0 ? Math.max(...stockHistory.map(h => h.id)) + 1 : 1,
                date: new Date().toISOString().replace('T', ' ').substr(0, 19),
                action: "Delete",
                item: deletedItem.name,
                quantityChange: `-${deletedItem.quantity}`,
                previousQty: deletedItem.quantity,
                newQty: 0,
                user: "Admin"
            };
            stockHistory.push(historyRecord);

            // Remove from stock items
            stockItems.splice(itemIndex, 1);

            // Save to localStorage
            saveToLocalStorage();

            // Update UI
            updateDashboard();
            loadStockTable();
            updateItemDropdown();
            loadHistoryTable();

            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
            modal.hide();

            // Show success message
            showAlert('Item deleted successfully!', 'success');
        });
    }

    // Initialize charts
    function initializeCharts() {
        // Stock Overview Chart (Bar Chart)
        const stockCtx = document.getElementById('stockChart').getContext('2d');
        const categories = [...new Set(stockItems.map(item => item.category))];
        const categoryCounts = categories.map(category =>
            stockItems.filter(item => item.category === category).length
        );

        const stockChart = new Chart(stockCtx, {
            type: 'bar',
            data: {
                labels: categories,
                datasets: [{
                    label: 'Items per Category',
                    data: categoryCounts,
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.5)',
                        'rgba(255, 99, 132, 0.5)',
                        'rgba(75, 192, 192, 0.5)',
                        'rgba(255, 205, 86, 0.5)',
                        'rgba(153, 102, 255, 0.5)',
                        'rgba(255, 159, 64, 0.5)'
                    ],
                    borderColor: [
                        'rgb(54, 162, 235)',
                        'rgb(255, 99, 132)',
                        'rgb(75, 192, 192)',
                        'rgb(255, 205, 86)',
                        'rgb(153, 102, 255)',
                        'rgb(255, 159, 64)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            }
        });

        // Category Distribution Chart (Pie Chart)
        const categoryCtx = document.getElementById('categoryChart').getContext('2d');
        const categoryValues = categories.map(category =>
            stockItems
                .filter(item => item.category === category)
                .reduce((sum, item) => sum + item.totalValue, 0)
        );

        const categoryChart = new Chart(categoryCtx, {
            type: 'pie',
            data: {
                labels: categories,
                datasets: [{
                    label: 'Value by Category',
                    data: categoryValues,
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.5)',
                        'rgba(255, 99, 132, 0.5)',
                        'rgba(75, 192, 192, 0.5)',
                        'rgba(255, 205, 86, 0.5)',
                        'rgba(153, 102, 255, 0.5)',
                        'rgba(255, 159, 64, 0.5)'
                    ],
                    borderColor: [
                        'rgb(54, 162, 235)',
                        'rgb(255, 99, 132)',
                        'rgb(75, 192, 192)',
                        'rgb(255, 205, 86)',
                        'rgb(153, 102, 255)',
                        'rgb(255, 159, 64)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'right',
                    }
                }
            }
        });

        // Store chart references for updates
        window.stockChart = stockChart;
        window.categoryChart = categoryChart;
    }

    // Helper Functions
    function updateItemStatusForItem(item) {
        if (item.quantity <= 0) {
            item.status = "Out of Stock";
        } else if (item.quantity <= item.threshold) {
            item.status = "Low Stock";
        } else {
            item.status = "In Stock";
        }
    }

    function editStockItem(itemId) {
        const item = stockItems.find(item => item.id === itemId);
        if (!item) return;

        document.getElementById('editItemId').value = item.id;
        document.getElementById('editItemName').value = item.name;
        document.getElementById('editItemCategory').value = item.category;
        document.getElementById('editItemQuantity').value = item.quantity;
        document.getElementById('editItemPrice').value = item.price;
        document.getElementById('editItemDescription').value = item.description || '';

        const modal = new bootstrap.Modal(document.getElementById('editStockModal'));
        modal.show();
    }

    function showDeleteModal(itemId, itemName) {
        document.getElementById('deleteItemName').textContent = itemName;
        document.getElementById('confirmDeleteBtn').setAttribute('data-item-id', itemId);

        const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
        modal.show();
    }

    function showAlert(message, type) {
        // Remove any existing alerts
        const existingAlert = document.querySelector('.alert-dismissible');
        if (existingAlert) {
            existingAlert.remove();
        }

        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed top-0 end-0 m-3`;
        alertDiv.style.zIndex = '1050';
        alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

        document.body.appendChild(alertDiv);

        // Auto remove after 3 seconds
        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.remove();
            }
        }, 3000);
    }

    function downloadJSON(data, filename) {
        const dataStr = JSON.stringify(data, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });

        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `${filename}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function downloadCSV(data, filename) {
        // Simple CSV for items
        let csvContent = "data:text/csv;charset=utf-8,";

        // Items CSV
        csvContent += "Stock Items\n";
        csvContent += "Name,Category,Quantity,Unit Price,Total Value,Status\n";

        data.items.forEach(item => {
            csvContent += `${item.name},${item.category},${item.quantity},${item.price},${item.totalValue},${item.status}\n`;
        });

        csvContent += "\n\nHistory\n";
        csvContent += "Date,Action,Item,Quantity Change,Previous Qty,New Qty,User\n";

        data.history.forEach(record => {
            csvContent += `${record.date},${record.action},${record.item},${record.quantityChange},${record.previousQty},${record.newQty},${record.user}\n`;
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement('a');
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", `${filename}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
</script>
</body>
</html>